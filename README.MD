# Sensorama API

API para o jogo sensorama
---

## üìÅ Arquitetura de Pastas

```
beeHelp-api/
‚îú‚îÄ‚îÄ .mvn/                      # Maven Wrapper
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ java/br/com/starter/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ application/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/             # Controllers REST
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useCase/         # Casos de uso (Service Layer)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ domain/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth/            # Entidade Auth e servi√ßo
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user/            # Entidade User, UserService, reposit√≥rio
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ role/            # Entidade Role, RoleService, RoleRepository
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ privilege/       # Entidade Privilege, PrivilegeService
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ profile/         # Entidade Profile, ProfileService
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ address/         # Entidade Address, AddressService
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ common/          # Entidades comuns (ex: AuditableEntity)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ infrastructure/
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ config/          # Configura√ß√µes de security, CORS, hierarquia de pap√©is
‚îÇ   ‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ security/        # Configura√ß√µes de seguran√ßa (JWT, CORS)
‚îÇ   ‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ boot/            # Arquivos de inicializa√ß√£o
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ exceptions/      # exce√ß√µes personalizadas
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ jwt/             # Gera√ß√£o e valida√ß√£o de JWT
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ services/utils/  # Utils: sanitiza√ß√£o, valida√ß√£o de documentos
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ resources/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ application.properties
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ application-dev.properties
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ application-prod.properties
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ db/migration/        # Scripts Flyway (V1__initial_schema.sql)
‚îÇ   ‚îî‚îÄ‚îÄ test/
‚îÇ       ‚îî‚îÄ‚îÄ java/br/com/starter/     # Testes de integra√ß√£o
‚îú‚îÄ‚îÄ target/                   # Build output
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ Dockerfile               # Dockerfile da API (com multi-stage build)
‚îú‚îÄ‚îÄ mvnw, mvnw.cmd           # Maven Wrapper
‚îú‚îÄ‚îÄ pom.xml
‚îî‚îÄ‚îÄ .gitignore
```

---

## üõ† Tecnologias e Frameworks

- **Java 21**
- **Spring Boot 3.4.0**
- **Maven**
- **Spring Data JPA + PostgreSQL**
- **Flyway** (migra√ß√£o de schema)
- **Spring Security + JWT (jjwt)**
- **Hibernate Validator + Jakarta Validation**
- **Jackson (data/hora - jsr310)**
- **Lombok**
- **Docker + Docker Compose**
- **Hibernate Envers** (auditoria de entidades)
---

## üöÄ Como Executar com Docker Compose

### Pr√©-requisitos:
- Docker e Docker Compose instalados

### Passos:

1. Compile o projeto localmente (opcional, se quiser pr√©-validar o build):
   ```bash
   ./mvnw clean package -DskipTests
   ```

2. Inicie os containers da API e do PostgreSQL:
   ```bash
   docker-compose up --build
   ```

3. Acesse a aplica√ß√£o:
   ```
   http://localhost:8080/sensorama/api/
   ```

> A aplica√ß√£o ser√° executada com o perfil `dev` por padr√£o e usar√° as vari√°veis de ambiente definidas no `docker-compose.yml`.

---

## üîó Endpoints Principais

### Autentica√ß√£o (p√∫blico)
- `POST /sensorama/api/public/users/login`  

### Usu√°rios (admin)
- `POST   /sensorama/api/public/users/register`(p√∫blico)
- `PUT    /sensorama/api/users/{id}`  
- `PATCH  /sensorama/api/users/{id}/update-password?newPassword=...`  
- `PATCH  /sensorama/api/users/{id}/update-username?newUsername=...`  
- `PATCH  /sensorama/api/users/{id}/privileges/{privilegeId}/add`  
- `PATCH  /sensorama/api/users/{id}/privileges/{privilegeId}/remove`  
- `PATCH  /sensorama/api/users/{id}/update-role/{roleId}`  
- `DELETE /sensorama/api/users/{id}`  

### Perfis
- `PATCH /sensorama/api/profiles/{id}/update-name?newName=...`  
- `PATCH /sensorama/api/profiles/update-name?newName=...`  

### Fun√ß√µes (roles)
- `GET    /sensorama/api/roles/{id}/privileges`  
- `POST   /sensorama/api/roles/{id}/privileges`  
- `DELETE /sensorama/api/roles/{id}/privileges`  

### Privil√©gios
- `POST   /sensorama/api/privileges?name=...`  
- `GET    /sensorama/api/privileges`  
- `PATCH  /sensorama/api/privileges/{id}/signature-revoked?isSignatureRevoked=...`  
- `DELETE /sensorama/api/privileges/{id}`  

---

## üìå Observa√ß√µes

- O backend se comunica com o banco via `SPRING_DATASOURCE_URL` usando o nome do servi√ßo Docker `postgres`.
- O volume `postgres_data` garante persist√™ncia dos dados mesmo ap√≥s parar os containers.
- O container da API usa um build otimizado com JDK 21 (etapa de build + JRE leve).

---
